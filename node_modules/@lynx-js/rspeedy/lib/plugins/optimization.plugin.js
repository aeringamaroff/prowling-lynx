export function pluginOptimization() {
    return {
        name: 'lynx:rsbuild:optimization',
        setup(api) {
            api.modifyBundlerChain((chain, { CHAIN_ID, isProd }) => {
                const rule = chain.module.rules.get(CHAIN_ID.RULE.JS);
                chain
                    .module
                    .rule('js-override-strict')
                    .type(rule.get('type'))
                    .test(rule.get('test'))
                    // We do not directly apply this to `CHAIN_ID.RULE.JS` since it will not
                    // includes the `node_modules` by default.
                    .parser({
                    // Make all the modules as strict to avoid entry being wrapped by IIFE.
                    // See: https://github.com/webpack/webpack/discussions/18367
                    overrideStrict: 'strict',
                })
                    .end();
                if (isProd) {
                    // Avoid entry being wrapped by IIFE
                    // See: https://rspack.dev/config/optimization#optimizationavoidentryiife
                    chain
                        .optimization
                        .avoidEntryIife(true);
                }
            });
        },
    };
}
//# sourceMappingURL=optimization.plugin.js.map